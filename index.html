<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#2563eb">
    <title>JustStep</title>
    <link rel="manifest" href="manifest.json">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #1a1a1a;
            color: #e8e8e8;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .app-container {
            max-width: 500px;
            margin: 0 auto;
            background: #1a1a1a;
            min-height: 100vh;
            position: relative;
            padding-bottom: 70px;
        }

        /* App Logo Header */
        .app-header {
            background: linear-gradient(135deg, #1e40af 0%, #1d4ed8 100%);
            padding: 16px 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: sticky;
            top: 0;
            z-index: 101;
            box-shadow: 0 2px 8px rgba(30, 64, 175, 0.3);
        }

        .app-logo {
            font-size: 24px;
        }

        .app-name {
            font-size: 22px;
            font-weight: 700;
            color: white;
            letter-spacing: -0.5px;
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            background: #2d2d2d;
            border-bottom: 1px solid #3d3d3d;
            position: sticky;
            top: 56px;
            z-index: 100;
        }

        .nav-tab {
            flex: 1;
            padding: 16px;
            text-align: center;
            background: none;
            border: none;
            font-size: 13px;
            font-weight: 500;
            color: #9ca3af;
            cursor: pointer;
            transition: all 0.2s;
            letter-spacing: 0.3px;
            text-transform: uppercase;
        }

        .nav-tab.active {
            color: #60a5fa;
            border-bottom: 2px solid #2563eb;
        }

        .screen {
            display: none;
            padding: 20px;
            animation: fadeIn 0.3s;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Typography */
        h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        h2 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 16px;
            letter-spacing: -0.3px;
        }

        .subtitle {
            color: #9ca3af;
            font-size: 14px;
            margin-bottom: 24px;
        }

        /* Daily Logging Screen */
        .date-selector {
            background: #2d2d2d;
            padding: 12px 16px;
            border-radius: 12px;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .date-selector span {
            filter: brightness(1.5) contrast(1.2);
        }

        .date-selector input {
            border: none;
            background: none;
            font-size: 16px;
            font-weight: 600;
            color: #e8e8e8;
            color-scheme: dark;
        }

        .activities-container {
            margin-bottom: 16px;
        }

        .activity-card {
            background: #2d2d2d;
            border: 2px solid #3d3d3d;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            position: relative;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-10px); }
        }

        .activity-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .activity-card-title {
            font-size: 13px;
            font-weight: 600;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .remove-activity {
            background: none;
            border: none;
            color: #6b7280;
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .remove-activity:hover {
            background: #3d1f1f;
            color: #ef4444;
        }

        .activity-type-select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #3d3d3d;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            background: #2d2d2d;
            color: #e8e8e8;
            margin-bottom: 12px;
            cursor: pointer;
        }

        .activity-type-select:focus {
            outline: none;
            border-color: #2563eb;
        }

        .activity-value-input {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .activity-value-input input {
            flex: 1;
            padding: 14px 16px;
            border: 2px solid #3d3d3d;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            background: #2d2d2d;
            color: #e8e8e8;
            color-scheme: dark;
        }

        .activity-value-input input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
        }

        .activity-value-input .unit {
            color: #6b7280;
            font-size: 14px;
            font-weight: 500;
            min-width: 40px;
        }

        .add-activity-button {
            width: 100%;
            padding: 14px;
            background: #2d2d2d;
            color: #60a5fa;
            border: 2px dashed #3d3d3d;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 16px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .add-activity-button:active {
            transform: scale(0.98);
            background: #1e3a5f;
        }

        .log-button {
            width: 100%;
            padding: 16px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 24px;
            transition: all 0.2s;
            letter-spacing: 0.3px;
        }

        .log-button:active {
            transform: scale(0.98);
            background: #1d4ed8;
        }

        .workout-confirmed {
            padding: 14px 16px;
            background: #1e3a5f;
            border-radius: 12px;
            color: #60a5fa;
            font-weight: 600;
            font-size: 14px;
            text-align: center;
        }

        /* Dashboard Screen */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: #2d2d2d;
            border: 2px solid #3d3d3d;
            border-radius: 16px;
            padding: 20px;
            transition: all 0.2s;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #e8e8e8;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .progress-card {
            background: #2d2d2d;
            border: 2px solid #3d3d3d;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .progress-title {
            font-size: 16px;
            font-weight: 600;
            color: #e8e8e8;
        }

        .progress-percentage {
            font-size: 24px;
            font-weight: 700;
            color: #60a5fa;
        }

        .progress-bar-bg {
            width: 100%;
            height: 8px;
            background: #3d3d3d;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #2563eb 0%, #3b82f6 100%);
            border-radius: 8px;
            transition: width 0.5s ease;
        }

        .progress-details {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            color: #9ca3af;
        }

        .milestone-list {
            margin-top: 12px;
        }

        .milestone-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #3d3d3d;
        }

        .milestone-item:last-child {
            border-bottom: none;
        }

        .milestone-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #2563eb;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 16px;
        }

        .milestone-text {
            font-size: 14px;
            font-weight: 500;
            color: #e8e8e8;
        }

        /* Calendar View */
        .calendar-header {
            text-align: center;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .calendar-nav {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            color: #9ca3af;
        }

        .calendar-month-year {
            font-size: 20px;
            font-weight: 600;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }

        .calendar-day-label {
            text-align: center;
            font-size: 11px;
            color: #6b7280;
            font-weight: 600;
            padding: 8px 0;
            text-transform: uppercase;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            background: #2d2d2d;
            border: 2px solid #3d3d3d;
            position: relative;
            cursor: pointer;
            color: #e8e8e8;
        }

        .calendar-day.has-activity {
            border-color: #2563eb;
            background: #1e3a5f;
        }

        .calendar-day.today {
            border-color: #60a5fa;
            font-weight: 700;
        }

        .calendar-day.other-month {
            color: #4b5563;
        }

        .activity-dots {
            display: flex;
            gap: 2px;
            margin-top: 4px;
        }

        .activity-dot {
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: #2563eb;
        }

        /* Goals Screen */
        .goal-input {
            margin-bottom: 24px;
        }

        .goal-input label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #e8e8e8;
            margin-bottom: 8px;
        }

        .goal-description {
            font-size: 13px;
            color: #9ca3af;
            margin-bottom: 12px;
        }

        .goal-input input, .goal-input select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #3d3d3d;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            background: #2d2d2d;
            color: #e8e8e8;
            color-scheme: dark;
        }

        .save-button {
            width: 100%;
            padding: 16px;
            background: #1a1a1a;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 12px;
            letter-spacing: 0.3px;
        }

        .save-button:active {
            transform: scale(0.98);
            background: #333;
        }

        .info-box {
            margin-top: 32px;
            padding: 20px;
            background: #2d2d2d;
            border-radius: 12px;
        }

        .info-box-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .info-box-content {
            font-size: 13px;
            color: #9ca3af;
            line-height: 1.8;
        }

        /* Milestone Notification */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }

        .overlay.show {
            display: block;
        }

        .milestone-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #2d2d2d;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 320px;
            z-index: 1000;
            display: none;
        }

        .milestone-notification.show {
            display: block;
            animation: popIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes popIn {
            0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .milestone-icon-large {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #2563eb;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 40px;
        }

        .milestone-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .milestone-description {
            font-size: 14px;
            color: #9ca3af;
            margin-bottom: 24px;
        }

        .milestone-close {
            width: 100%;
            padding: 14px;
            background: #2d2d2d;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
        }

        .export-button {
            width: 100%;
            padding: 16px;
            background: #2d2d2d;
            color: #e8e8e8;
            border: 2px solid #3d3d3d;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 12px;
            letter-spacing: 0.3px;
        }

        .export-button:active {
            transform: scale(0.98);
            background: #2d2d2d;
        }

        .success-message {
            background: #1e3a5f;
            color: #2563eb;
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            margin-top: 12px;
            display: none;
            text-align: center;
        }

        .success-message.show {
            display: block;
            animation: fadeIn 0.3s;
        }

        /* Day Detail Modal */
        .day-detail-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #2d2d2d;
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 360px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .day-detail-modal.show {
            display: block;
            animation: popIn 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .day-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid #3d3d3d;
        }

        .day-detail-date {
            font-size: 20px;
            font-weight: 700;
            color: #e8e8e8;
        }

        .day-detail-close {
            background: none;
            border: none;
            font-size: 24px;
            color: #6b7280;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
        }

        .day-detail-close:hover {
            background: #3d3d3d;
        }

        .day-activity-list {
            margin-bottom: 16px;
        }

        .day-activity-item {
            background: #1a1a1a;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #3d3d3d;
        }

        .day-activity-info {
            flex: 1;
        }

        .day-activity-type {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
            text-transform: capitalize;
            color: #e8e8e8;
            background: none !important;
        }

        .day-activity-value {
            font-size: 14px;
            color: #9ca3af;
        }

        .day-activity-delete {
            background: #3d1f1f;
            color: #ef4444;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .day-activity-delete:hover {
            background: #4d2626;
            color: #f87171;
        }

        .day-totals {
            background: #1e3a5f;
            padding: 16px;
            border-radius: 12px;
            margin-top: 16px;
        }

        .day-totals-title {
            font-size: 13px;
            font-weight: 600;
            color: #60a5fa;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .day-totals-content {
            font-size: 14px;
            color: #e8e8e8;
            line-height: 1.8;
        }

        .empty-day {
            text-align: center;
            padding: 40px 20px;
            color: #6b7280;
        }

        .empty-day-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .empty-day-text {
            font-size: 14px;
        }

        .calendar-hint {
            text-align: center;
            margin-top: 16px;
            padding: 12px;
            background: #1e3a5f;
            border-radius: 12px;
            font-size: 13px;
            color: #60a5fa;
            font-weight: 500;
        }

        /* Stats Toggle */
        .stats-toggle {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            background: #2d2d2d;
            padding: 4px;
            border-radius: 12px;
            border: 2px solid #3d3d3d;
        }

        .stats-toggle-btn {
            flex: 1;
            padding: 10px 16px;
            background: none;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            color: #9ca3af;
            cursor: pointer;
            transition: all 0.2s;
            letter-spacing: 0.3px;
        }

        .stats-toggle-btn.active {
            background: #2563eb;
            color: white;
        }

        /* Welcome Modal (Improved for iPhone) */
        .welcome-modal {
            max-width: 360px;
            width: 92%;
            max-height: 85vh;
            padding: 24px;
            overflow: hidden;
            text-align: left;
        }

        .welcome-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .welcome-close-x {
            background: none;
            border: none;
            font-size: 26px;
            color: #9ca3af;
            cursor: pointer;
            padding: 0;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
        }

        .welcome-close-x:active {
            transform: scale(0.98);
            background: #3d3d3d;
        }

        .welcome-body {
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            max-height: 48vh;
            padding-right: 6px;
            margin-bottom: 16px;
        }

        .welcome-body p {
            margin-bottom: 12px;
        }

        .welcome-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .welcome-actions .log-button {
            margin-top: 0;
        }

        .welcome-actions .milestone-close {
            background: #2563eb;
            color: white;
            margin-top: 0;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- App Header -->
        <div class="app-header">
            <span class="app-name">JustStep</span>
        </div>

        <!-- Navigation -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="app.showScreen('log')">Tracker</button>
            <button class="nav-tab" onclick="app.showScreen('dashboard')">Dashboard</button>
            <button class="nav-tab" onclick="app.showScreen('calendar')">Calendar</button>
            <button class="nav-tab" onclick="app.showScreen('goals')">Goals</button>
        </div>

        <!-- Daily Logging Screen -->
        <div id="log-screen" class="screen active">
            <h1>Track Activity</h1>
            <p class="subtitle">Record today's workout</p>

            <div class="date-selector">
                <span>ðŸ“…</span>
                <input type="date" id="log-date" value="">
            </div>

            <div id="activities-container" class="activities-container">
                <!-- Activity cards will be added here -->
            </div>

            <button class="add-activity-button" onclick="app.addActivityRow()">
                <span style="font-size: 20px; margin-right: 8px;">+</span>
                Add Activity
            </button>

            <button class="log-button" onclick="app.saveLog()">Save Activity</button>
        </div>

        <!-- Dashboard Screen -->
        <div id="dashboard-screen" class="screen">
            <h1>Dashboard</h1>
            <p class="subtitle">Your progress overview</p>

            <div class="stats-toggle">
                <button class="stats-toggle-btn active" onclick="app.setStatsView('week')">This Week</button>
                <button class="stats-toggle-btn" onclick="app.setStatsView('total')">All Time</button>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="stat-miles">0</div>
                    <div class="stat-label" id="stat-miles-label">Miles</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-pushups">0</div>
                    <div class="stat-label" id="stat-pushups-label">Push-ups</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-pullups">0</div>
                    <div class="stat-label" id="stat-pullups-label">Pull-ups</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-rollerabs">0</div>
                    <div class="stat-label" id="stat-rollerabs-label">Roller Abs</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-workouts">0</div>
                    <div class="stat-label" id="stat-workouts-label">Workouts</div>
                </div>
            </div>

            <div class="progress-card">
                <div class="progress-header">
                    <span class="progress-title">Annual Goal</span>
                    <span class="progress-percentage" id="annual-progress-percent">0%</span>
                </div>
                <div class="progress-bar-bg">
                    <div class="progress-bar-fill" id="annual-progress-bar" style="width: 0%"></div>
                </div>
                <div class="progress-details">
                    <span id="annual-progress-current">0</span>
                    <span id="annual-progress-goal">420</span>
                </div>
            </div>

            <h2>Recent Milestones</h2>
            <div class="progress-card">
                <div class="milestone-list" id="milestone-list">
                    <p style="text-align: center; color: #6b7280; font-size: 14px;">No milestones yet. Keep going!</p>
                </div>
            </div>
        </div>

        <!-- Calendar Screen -->
        <div id="calendar-screen" class="screen">
            <div class="calendar-header">
                <button class="calendar-nav" onclick="app.changeMonth(-1)">â€¹</button>
                <div class="calendar-month-year" id="calendar-month-year">January 2026</div>
                <button class="calendar-nav" onclick="app.changeMonth(1)">â€º</button>
            </div>

            <div class="calendar-grid" id="calendar-grid">
                <!-- Calendar will be generated here -->
            </div>

            <div class="calendar-hint">
                ðŸ’¡ Tap any day to see details
            </div>

            <div class="info-box">
                <div class="info-box-title">Legend</div>
                <div class="info-box-content">
                    â€¢ Dots = Different activity types logged that day<br>
                    â€¢ Bold border = Today<br>
                    â€¢ Blue = Activity logged
                </div>
            </div>
        </div>

        <!-- Goals Screen -->
        <div id="goals-screen" class="screen">
            <h1>Settings</h1>
            <p class="subtitle">Customize your goals and preferences</p>

            <div class="goal-input">
                <label>Unit Preference</label>
                <p class="goal-description">Choose your preferred distance unit</p>
                <select id="unit-preference">
                    <option value="miles">Miles</option>
                    <option value="km">Kilometers</option>
                </select>
            </div>

            <div class="goal-input">
                <label>Annual Mileage Goal</label>
                <p class="goal-description">Total distance goal for the year</p>
                <input type="number" id="annual-goal" value="420" placeholder="420">
            </div>

            <div class="goal-input">
                <label>Workout Frequency Target</label>
                <p class="goal-description">How many workouts per week?</p>
                <input type="number" id="workout-frequency" value="5" placeholder="5">
            </div>

            <div class="goal-input">
                <label>Monthly Mileage Target</label>
                <p class="goal-description">Optional: Set a monthly milestone</p>
                <input type="number" id="monthly-goal" value="35" placeholder="35">
            </div>

            <button class="save-button" onclick="app.saveGoals()">Save Settings</button>
            <div class="success-message" id="settings-success">Settings saved successfully!</div>

            <div class="info-box">
                <div class="info-box-title">Milestone Settings</div>
                <div class="info-box-content">
                    âœ“ Mileage milestone every 50 <span id="milestone-unit">miles</span><br>
                    âœ“ Workout milestone every 25 workouts<br>
                    âœ“ Monthly goal completion check
                </div>
            </div>

            <button class="export-button" onclick="app.exportData()">Export All Data</button>
        </div>
    </div>

    <!-- Milestone Notification -->
    <div class="overlay" id="overlay" onclick="app.closeMilestone()"></div>
    <div class="milestone-notification" id="milestone-notification">
        <div class="milestone-icon-large" id="milestone-icon">ðŸŽ¯</div>
        <div class="milestone-title" id="milestone-title">Milestone Reached</div>
        <div class="milestone-description" id="milestone-description">Great work!</div>
        <button class="milestone-close" onclick="app.closeMilestone()">Continue</button>
    </div>

    <!-- Welcome Modal (EVERY OPEN) -->
    <div class="overlay" id="welcome-overlay" onclick="app.closeWelcome()"></div>
    <div class="milestone-notification welcome-modal" id="welcome-modal" role="dialog" aria-modal="true" aria-labelledby="welcome-title">
        <div class="welcome-header">
            <div class="milestone-icon-large" style="margin: 0; width: 64px; height: 64px; font-size: 32px;">ðŸ‘Ÿ</div>
            <button class="welcome-close-x" onclick="app.closeWelcome()" aria-label="Close">Ã—</button>
        </div>

        <div class="milestone-title" id="welcome-title" style="margin-bottom: 10px;">Welcome to JustStep!</div>

        <div class="welcome-body">
            <p><strong>Success isn't comfortable.</strong></p>

            <p>
                Every workout, every mile,<br>
                every rep you track here is a step closer to your goal.
            </p>

            <p>
                Don't focus on the whole staircase,<br>
                Just take the next Step!
            </p>

            <p>
                The magic you are looking for<br>
                is in the work you just did.
            </p>

            <p style="font-weight: 700;">
                Track it. Own it. Grow.
            </p>
        </div>

        <div class="welcome-actions">
            <a href="https://www.youtube.com/watch?v=ZuHHYRD6AHQ&start=0"
               target="_blank"
               rel="noopener noreferrer"
               class="log-button"
               style="display: block; text-decoration: none;">
                â–¶ Watch the full video
            </a>

            <button class="milestone-close" onclick="app.closeWelcome()">Let's Go</button>
        </div>
    </div>

    <!-- Day Detail Modal -->
    <div class="overlay" id="day-overlay" onclick="app.closeDayDetail()"></div>
    <div class="day-detail-modal" id="day-detail-modal">
        <div class="day-detail-header">
            <div class="day-detail-date" id="day-detail-date">January 15, 2026</div>
            <button class="day-detail-close" onclick="app.closeDayDetail()">Ã—</button>
        </div>
        <div id="day-detail-content">
            <!-- Content will be populated dynamically -->
        </div>
    </div>

    <script>
        // Main App Object
        const app = {
            data: {
                activities: [], // All logged activities
                goals: {
                    annualMiles: 420,
                    workoutFrequency: 5,
                    monthlyMiles: 35,
                    unitPreference: 'miles'
                },
                milestones: [],
                currentView: {
                    screen: 'log',
                    statsView: 'week', // 'week' or 'total'
                    calendarMonth: new Date().getMonth(),
                    calendarYear: new Date().getFullYear()
                }
            },
            activityCounter: 0,

            // Initialize app
            init() {
                this.loadData();
                this.setupLogDate();
                this.addActivityRow();
                this.updateDashboard();
                this.renderCalendar();
                this.updateGoalsUI();
                this.showWelcome();
            },

            // Load data from localStorage
            loadData() {
                const saved = localStorage.getItem('justStepData');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    this.data = { ...this.data, ...parsed };
                    // Ensure statsView exists (for users upgrading from old version)
                    if (!this.data.currentView.statsView) {
                        this.data.currentView.statsView = 'week';
                    }
                }
            },

            // Save data to localStorage
            saveData() {
                localStorage.setItem('justStepData', JSON.stringify(this.data));
            },

            // Show welcome message (every app open)
            showWelcome() {
                document.getElementById('welcome-overlay').classList.add('show');
                document.getElementById('welcome-modal').classList.add('show');
            },

            // Close welcome modal
            closeWelcome() {
                document.getElementById('welcome-overlay').classList.remove('show');
                document.getElementById('welcome-modal').classList.remove('show');
            },

            // Setup log date input
            setupLogDate() {
                const dateInput = document.getElementById('log-date');
                const today = new Date().toISOString().split('T')[0];
                dateInput.value = today;
            },

            // Add activity row
            addActivityRow() {
                this.activityCounter++;
                const container = document.getElementById('activities-container');
                const isFirst = this.activityCounter === 1;

                const activityCard = document.createElement('div');
                activityCard.className = 'activity-card';
                activityCard.id = `activity-${this.activityCounter}`;

                activityCard.innerHTML = `
                    <div class="activity-card-header">
                        <span class="activity-card-title">Activity ${this.activityCounter}</span>
                        <button class="remove-activity" onclick="app.removeActivity(${this.activityCounter})" ${isFirst ? 'style="visibility: hidden;"' : ''}>Ã—</button>
                    </div>

                    <select class="activity-type-select" id="type-${this.activityCounter}" onchange="app.updateActivityInputs(${this.activityCounter}, this.value)">
                        <option value="">Select activity type...</option>
                        <optgroup label="Cardio">
                            <option value="dog">Dog Walk</option>
                            <option value="hiking">Hiking</option>
                            <option value="run">Running</option>
                            <option value="walk">Walk</option>
                        </optgroup>
                        <optgroup label="Strength">
                            <option value="arm">Arm Day</option>
                            <option value="back">Back Day</option>
                            <option value="chest">Chest Day</option>
                            <option value="core">Core Day</option>
                            <option value="fullbody">Full Body Day</option>
                            <option value="leg">Leg Day</option>
                            <option value="pullups">Pull-ups</option>
                            <option value="pushups">Push-ups</option>
                            <option value="rollerabs">Roller Abs</option>
                            <option value="shoulder">Shoulder Day</option>
                        </optgroup>
                    </select>

                    <div id="value-input-${this.activityCounter}">
                        <!-- Value input will be inserted here -->
                    </div>
                `;

                container.appendChild(activityCard);
            },

            // Update activity inputs based on type
            updateActivityInputs(id, activityType) {
                const valueContainer = document.getElementById(`value-input-${id}`);
                const unit = this.data.goals.unitPreference === 'km' ? 'km' : 'miles';

                if (!activityType) {
                    valueContainer.innerHTML = '';
                    return;
                }

                // For cardio activities
                if (['walk', 'run', 'dog', 'hiking'].includes(activityType)) {
                    valueContainer.innerHTML = `
                        <div class="activity-value-input">
                            <input type="number" step="0.1" placeholder="0.0" id="value-${id}" />
                            <span class="unit">${unit}</span>
                        </div>
                    `;
                }
                // For push-ups, pull-ups, and roller abs
                else if (['pushups', 'pullups', 'rollerabs'].includes(activityType)) {
                    valueContainer.innerHTML = `
                        <div class="activity-value-input">
                            <input type="number" placeholder="0" id="value-${id}" />
                            <span class="unit">reps</span>
                        </div>
                    `;
                }
                // For workout days
                else {
                    valueContainer.innerHTML = `
                        <div class="workout-confirmed">
                            âœ“ Workout logged
                        </div>
                    `;
                }
            },

            // Remove activity row
            removeActivity(id) {
                const activityCard = document.getElementById(`activity-${id}`);
                activityCard.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    activityCard.remove();
                }, 300);
            },

            // Save log
            saveLog() {
                const date = document.getElementById('log-date').value;
                if (!date) {
                    alert('Please select a date');
                    return;
                }

                const activities = [];
                for (let i = 1; i <= this.activityCounter; i++) {
                    const typeElement = document.getElementById(`type-${i}`);
                    if (!typeElement) continue;

                    const type = typeElement.value;
                    if (!type) continue;

                    const activity = {
                        date: date,
                        type: type,
                        timestamp: new Date().toISOString()
                    };

                    // Get value for cardio and reps-based exercises
                    const valueElement = document.getElementById(`value-${i}`);
                    if (valueElement) {
                        const value = parseFloat(valueElement.value);
                        if (value && value > 0) {
                            if (['walk', 'run', 'dog', 'hiking'].includes(type)) {
                                // Convert to km for storage if in miles
                                activity.distance = this.data.goals.unitPreference === 'miles' ? value * 1.60934 : value;
                            } else if (['pushups', 'pullups', 'rollerabs'].includes(type)) {
                                activity.reps = value;
                            }
                        } else if (['walk', 'run', 'dog', 'hiking', 'pushups', 'pullups', 'rollerabs'].includes(type)) {
                            continue; // Skip if no value entered for activities that need it
                        }
                    }

                    activities.push(activity);
                }

                if (activities.length === 0) {
                    alert('Please add at least one activity');
                    return;
                }

                // Add to data
                this.data.activities.push(...activities);
                this.saveData();

                // Check for milestones
                this.checkMilestones();

                // Clear form
                document.getElementById('activities-container').innerHTML = '';
                this.activityCounter = 0;
                this.addActivityRow();

                // Update UI
                this.updateDashboard();
                this.renderCalendar();

                // Show success
                alert('Activity logged successfully!');
            },

            // Check for milestones
            checkMilestones() {
                const stats = this.calculateStats();
                const newMilestones = [];

                // Check mileage milestones (every 50)
                const milesAchieved = Math.floor(stats.totalDistance / 50) * 50;
                const lastMilageMilestone = this.data.milestones.filter(m => m.type === 'mileage').reduce((max, m) => Math.max(max, m.value), 0);

                if (milesAchieved > lastMilageMilestone && milesAchieved > 0) {
                    const unit = this.data.goals.unitPreference === 'km' ? 'km' : 'miles';
                    newMilestones.push({
                        type: 'mileage',
                        value: milesAchieved,
                        date: new Date().toISOString(),
                        icon: 'ðŸŽ¯',
                        title: `${milesAchieved} ${unit} Reached!`,
                        description: `You've logged ${milesAchieved} ${unit}. Keep up the great work!`
                    });
                }

                // Check workout milestones (every 25)
                const workoutsAchieved = Math.floor(stats.totalWorkouts / 25) * 25;
                const lastWorkoutMilestone = this.data.milestones.filter(m => m.type === 'workout').reduce((max, m) => Math.max(max, m.value), 0);

                if (workoutsAchieved > lastWorkoutMilestone && workoutsAchieved > 0) {
                    newMilestones.push({
                        type: 'workout',
                        value: workoutsAchieved,
                        date: new Date().toISOString(),
                        icon: 'ðŸ’ª',
                        title: `${workoutsAchieved} Workouts Completed!`,
                        description: `Amazing consistency! You've completed ${workoutsAchieved} workouts.`
                    });
                }

                // Add new milestones and show notification
                if (newMilestones.length > 0) {
                    this.data.milestones.push(...newMilestones);
                    this.saveData();
                    this.showMilestone(newMilestones[0]);
                }
            },

            // Show milestone notification
            showMilestone(milestone) {
                document.getElementById('milestone-icon').textContent = milestone.icon;
                document.getElementById('milestone-title').textContent = milestone.title;
                document.getElementById('milestone-description').textContent = milestone.description;
                document.getElementById('overlay').classList.add('show');
                document.getElementById('milestone-notification').classList.add('show');
            },

            // Close milestone
            closeMilestone() {
                document.getElementById('overlay').classList.remove('show');
                document.getElementById('milestone-notification').classList.remove('show');
            },

            // Calculate stats
            calculateStats() {
                const now = new Date();
                const startOfYear = new Date(now.getFullYear(), 0, 1);
                // Fix: Set start of week to midnight to avoid timezone issues
                const startOfWeek = new Date(now);
                startOfWeek.setDate(now.getDate() - now.getDay());
                startOfWeek.setHours(0, 0, 0, 0);

                let totalDistance = 0;
                let weekDistance = 0;
                let totalPushups = 0;
                let weekPushups = 0;
                let totalPullups = 0;
                let weekPullups = 0;
                let totalRollerAbs = 0;
                let weekRollerAbs = 0;
                let totalWorkouts = 0;
                let weekWorkouts = 0;

                this.data.activities.forEach(activity => {
                    // Fix: Parse date at noon to avoid timezone issues
                    const activityDate = new Date(activity.date + 'T12:00:00');
                    const isThisWeek = activityDate >= startOfWeek;

                    // Total distance (stored in km)
                    if (activity.distance) {
                        totalDistance += activity.distance;
                        if (isThisWeek) {
                            weekDistance += activity.distance;
                        }
                    }

                    // Total reps by type
                    if (activity.reps) {
                        if (activity.type === 'pushups') {
                            totalPushups += activity.reps;
                            if (isThisWeek) weekPushups += activity.reps;
                        } else if (activity.type === 'pullups') {
                            totalPullups += activity.reps;
                            if (isThisWeek) weekPullups += activity.reps;
                        } else if (activity.type === 'rollerabs') {
                            totalRollerAbs += activity.reps;
                            if (isThisWeek) weekRollerAbs += activity.reps;
                        }
                    }

                    // Total workouts (any non-cardio activity)
                    if (['arm', 'back', 'chest', 'core', 'fullbody', 'leg', 'shoulder'].includes(activity.type)) {
                        totalWorkouts++;
                        if (isThisWeek) weekWorkouts++;
                    }
                });

                // Convert to preferred unit for display
                if (this.data.goals.unitPreference === 'miles') {
                    totalDistance = totalDistance / 1.60934;
                    weekDistance = weekDistance / 1.60934;
                }

                return {
                    totalDistance: Math.round(totalDistance * 10) / 10,
                    weekDistance: Math.round(weekDistance * 10) / 10,
                    totalPushups,
                    weekPushups,
                    totalPullups,
                    weekPullups,
                    totalRollerAbs,
                    weekRollerAbs,
                    totalWorkouts,
                    weekWorkouts
                };
            },

            // Update dashboard
            updateDashboard() {
                const stats = this.calculateStats();
                const unit = this.data.goals.unitPreference === 'km' ? 'km' : 'miles';
                const isWeekView = this.data.currentView.statsView === 'week';

                // Update stats based on toggle
                if (isWeekView) {
                    document.getElementById('stat-miles').textContent = stats.weekDistance;
                    document.getElementById('stat-pushups').textContent = stats.weekPushups;
                    document.getElementById('stat-pullups').textContent = stats.weekPullups;
                    document.getElementById('stat-rollerabs').textContent = stats.weekRollerAbs;
                    document.getElementById('stat-workouts').textContent = stats.weekWorkouts;
                } else {
                    document.getElementById('stat-miles').textContent = stats.totalDistance;
                    document.getElementById('stat-pushups').textContent = stats.totalPushups;
                    document.getElementById('stat-pullups').textContent = stats.totalPullups;
                    document.getElementById('stat-rollerabs').textContent = stats.totalRollerAbs;
                    document.getElementById('stat-workouts').textContent = stats.totalWorkouts;
                }

                // Update labels
                document.getElementById('stat-miles-label').textContent = unit;
                document.getElementById('stat-pushups-label').textContent = 'Push-ups';
                document.getElementById('stat-pullups-label').textContent = 'Pull-ups';
                document.getElementById('stat-rollerabs-label').textContent = 'Roller Abs';
                document.getElementById('stat-workouts-label').textContent = 'Workouts';

                // Annual progress (always total)
                const annualGoal = this.data.goals.annualMiles;
                const progress = Math.min(100, Math.round((stats.totalDistance / annualGoal) * 100));
                document.getElementById('annual-progress-percent').textContent = `${progress}%`;
                document.getElementById('annual-progress-bar').style.width = `${progress}%`;
                document.getElementById('annual-progress-current').textContent = `${stats.totalDistance} ${unit}`;
                document.getElementById('annual-progress-goal').textContent = `${annualGoal} ${unit}`;

                // Recent milestones
                const milestoneList = document.getElementById('milestone-list');
                if (this.data.milestones.length === 0) {
                    milestoneList.innerHTML = '<p style="text-align: center; color: #6b7280; font-size: 14px;">No milestones yet. Keep going!</p>';
                } else {
                    const recentMilestones = this.data.milestones.slice(-5).reverse();
                    milestoneList.innerHTML = recentMilestones.map(m => `
                        <div class="milestone-item">
                            <div class="milestone-icon">${m.icon}</div>
                            <div class="milestone-text">${m.title}</div>
                        </div>
                    `).join('');
                }
            },

            // Set stats view (week or total)
            setStatsView(view) {
                this.data.currentView.statsView = view;

                // Update toggle buttons
                document.querySelectorAll('.stats-toggle-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                event.target.classList.add('active');

                // Refresh dashboard
                this.updateDashboard();
            },

            // Render calendar
            renderCalendar() {
                const year = this.data.currentView.calendarYear;
                const month = this.data.currentView.calendarMonth;

                const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                                   'July', 'August', 'September', 'October', 'November', 'December'];

                document.getElementById('calendar-month-year').textContent = `${monthNames[month]} ${year}`;

                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const prevLastDay = new Date(year, month, 0);

                const firstDayOfWeek = firstDay.getDay();
                const daysInMonth = lastDay.getDate();
                const daysInPrevMonth = prevLastDay.getDate();

                const grid = document.getElementById('calendar-grid');
                grid.innerHTML = `
                    <div class="calendar-day-label">Sun</div>
                    <div class="calendar-day-label">Mon</div>
                    <div class="calendar-day-label">Tue</div>
                    <div class="calendar-day-label">Wed</div>
                    <div class="calendar-day-label">Thu</div>
                    <div class="calendar-day-label">Fri</div>
                    <div class="calendar-day-label">Sat</div>
                `;

                // Previous month days
                for (let i = firstDayOfWeek - 1; i >= 0; i--) {
                    const day = daysInPrevMonth - i;
                    const dayDiv = document.createElement('div');
                    dayDiv.className = 'calendar-day other-month';
                    dayDiv.textContent = day;
                    grid.appendChild(dayDiv);
                }

                // Current month days
                const today = new Date();
                for (let day = 1; day <= daysInMonth; day++) {
                    const date = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    const activities = this.data.activities.filter(a => a.date === date);

                    const dayDiv = document.createElement('div');
                    dayDiv.className = 'calendar-day';
                    dayDiv.style.cursor = 'pointer';
                    dayDiv.onclick = () => this.showDayDetail(date);

                    if (activities.length > 0) {
                        dayDiv.classList.add('has-activity');
                    }

                    if (today.getDate() === day && today.getMonth() === month && today.getFullYear() === year) {
                        dayDiv.classList.add('today');
                    }

                    dayDiv.innerHTML = `
                        ${day}
                        ${activities.length > 0 ? `
                            <div class="activity-dots">
                                ${activities.slice(0, 4).map(() => '<div class="activity-dot"></div>').join('')}
                            </div>
                        ` : ''}
                    `;

                    grid.appendChild(dayDiv);
                }

                // Next month days
                const remainingDays = 42 - (firstDayOfWeek + daysInMonth);
                for (let day = 1; day <= remainingDays; day++) {
                    const dayDiv = document.createElement('div');
                    dayDiv.className = 'calendar-day other-month';
                    dayDiv.textContent = day;
                    grid.appendChild(dayDiv);
                }
            },

            // Change calendar month
            changeMonth(delta) {
                this.data.currentView.calendarMonth += delta;
                if (this.data.currentView.calendarMonth > 11) {
                    this.data.currentView.calendarMonth = 0;
                    this.data.currentView.calendarYear++;
                } else if (this.data.currentView.calendarMonth < 0) {
                    this.data.currentView.calendarMonth = 11;
                    this.data.currentView.calendarYear--;
                }
                this.renderCalendar();
            },

            // Update goals UI
            updateGoalsUI() {
                document.getElementById('unit-preference').value = this.data.goals.unitPreference;
                document.getElementById('annual-goal').value = this.data.goals.annualMiles;
                document.getElementById('workout-frequency').value = this.data.goals.workoutFrequency;
                document.getElementById('monthly-goal').value = this.data.goals.monthlyMiles;

                const unit = this.data.goals.unitPreference === 'km' ? 'km' : 'miles';
                document.getElementById('milestone-unit').textContent = unit;
            },

            // Save goals
            saveGoals() {
                const oldUnit = this.data.goals.unitPreference;
                const newUnit = document.getElementById('unit-preference').value;

                this.data.goals.unitPreference = newUnit;
                this.data.goals.annualMiles = parseInt(document.getElementById('annual-goal').value);
                this.data.goals.workoutFrequency = parseInt(document.getElementById('workout-frequency').value);
                this.data.goals.monthlyMiles = parseInt(document.getElementById('monthly-goal').value);

                this.saveData();
                this.updateGoalsUI();
                this.updateDashboard();

                const successMsg = document.getElementById('settings-success');
                successMsg.classList.add('show');
                setTimeout(() => {
                    successMsg.classList.remove('show');
                }, 3000);
            },

            // Export data
            exportData() {
                const dataStr = JSON.stringify(this.data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `juststep-data-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
            },

            // Show screen
            showScreen(screenName) {
                // Update screens
                document.querySelectorAll('.screen').forEach(screen => {
                    screen.classList.remove('active');
                });
                document.getElementById(`${screenName}-screen`).classList.add('active');

                // Update tabs
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                event.target.classList.add('active');

                this.data.currentView.screen = screenName;

                // Refresh data for specific screens
                if (screenName === 'dashboard') {
                    this.updateDashboard();
                } else if (screenName === 'calendar') {
                    this.renderCalendar();
                }
            },

            // Show day detail modal
            showDayDetail(date) {
                const activities = this.data.activities.filter(a => a.date === date);
                const dateObj = new Date(date + 'T12:00:00');
                const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                                   'July', 'August', 'September', 'October', 'November', 'December'];
                const formattedDate = `${monthNames[dateObj.getMonth()]} ${dateObj.getDate()}, ${dateObj.getFullYear()}`;

                document.getElementById('day-detail-date').textContent = formattedDate;

                const content = document.getElementById('day-detail-content');

                if (activities.length === 0) {
                    content.innerHTML = `
                        <div class="empty-day">
                            <div class="empty-day-icon">ðŸ“­</div>
                            <div class="empty-day-text">No activities logged for this day</div>
                        </div>
                    `;
                } else {
                    const unit = this.data.goals.unitPreference === 'km' ? 'km' : 'miles';

                    // Group and calculate totals
                    let totalDistance = 0;
                    let totalPushups = 0;
                    let workoutCount = 0;

                    const activityHTML = activities.map((activity, index) => {
                        const activityNames = {
                            'walk': 'Walk',
                            'run': 'Running',
                            'dog': 'Dog Walk',
                            'hiking': 'Hiking',
                            'pushups': 'Push-ups',
                            'pullups': 'Pull-ups',
                            'rollerabs': 'Roller Abs',
                            'leg': 'Leg Day',
                            'chest': 'Chest Day',
                            'shoulder': 'Shoulder Day',
                            'core': 'Core Day',
                            'arm': 'Arm Day',
                            'back': 'Back Day',
                            'fullbody': 'Full Body Day'
                        };

                        let valueText = '';
                        if (activity.distance) {
                            const displayDistance = this.data.goals.unitPreference === 'miles'
                                ? (activity.distance / 1.60934).toFixed(1)
                                : activity.distance.toFixed(1);
                            valueText = `${displayDistance} ${unit}`;
                            totalDistance += activity.distance;
                        } else if (activity.reps) {
                            valueText = `${activity.reps} reps`;
                            totalPushups += activity.reps;
                        } else {
                            valueText = 'Completed';
                            workoutCount++;
                        }

                        return `
                            <div class="day-activity-item" data-activity-index="${this.data.activities.indexOf(activity)}">
                                <div class="day-activity-info">
                                    <div class="day-activity-type">${activityNames[activity.type] || activity.type}</div>
                                    <div class="day-activity-value">${valueText}</div>
                                </div>
                                <button class="day-activity-delete" onclick="app.deleteActivity(${this.data.activities.indexOf(activity)})">Delete</button>
                            </div>
                        `;
                    }).join('');

                    // Build totals section
                    const totals = [];
                    if (totalDistance > 0) {
                        const displayDistance = this.data.goals.unitPreference === 'miles'
                            ? (totalDistance / 1.60934).toFixed(1)
                            : totalDistance.toFixed(1);
                        totals.push(`${displayDistance} ${unit} total`);
                    }
                    if (totalPushups > 0) {
                        totals.push(`${totalPushups} push-ups`);
                    }
                    if (workoutCount > 0) {
                        totals.push(`${workoutCount} workout${workoutCount > 1 ? 's' : ''}`);
                    }

                    content.innerHTML = `
                        <div class="day-activity-list">
                            ${activityHTML}
                        </div>
                        ${totals.length > 0 ? `
                            <div class="day-totals">
                                <div class="day-totals-title">Day Summary</div>
                                <div class="day-totals-content">
                                    ${totals.join(' â€¢ ')}
                                </div>
                            </div>
                        ` : ''}
                    `;
                }

                document.getElementById('day-overlay').classList.add('show');
                document.getElementById('day-detail-modal').classList.add('show');
            },

            // Close day detail modal
            closeDayDetail() {
                document.getElementById('day-overlay').classList.remove('show');
                document.getElementById('day-detail-modal').classList.remove('show');
            },

            // Delete activity
            deleteActivity(activityIndex) {
                if (!confirm('Are you sure you want to delete this activity?')) {
                    return;
                }

                this.data.activities.splice(activityIndex, 1);
                this.saveData();

                // Refresh all views
                this.updateDashboard();
                this.renderCalendar();

                // Reopen the day detail with updated data
                const dateInput = document.getElementById('day-detail-date').textContent;
                const activities = this.data.activities.filter(a => {
                    const activityDate = new Date(a.date + 'T12:00:00');
                    const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                                       'July', 'August', 'September', 'October', 'November', 'December'];
                    const formattedDate = `${monthNames[activityDate.getMonth()]} ${activityDate.getDate()}, ${activityDate.getFullYear()}`;
                    return formattedDate === dateInput;
                });

                if (activities.length > 0) {
                    this.showDayDetail(activities[0].date);
                } else {
                    this.closeDayDetail();
                }
            }
        };

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', () => {
            app.init();
        });
    </script>
</body>
</html>
